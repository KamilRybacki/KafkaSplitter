version: '2.1'

services:
  tests-zoo:
    container_name: tests-zoo
    image: wurstmeister/zookeeper:3.4.6
    expose:
      - 2181

  tests-kafka:
    container_name: tests-kafka
    image: wurstmeister/kafka:latest
    expose:
      - 9092
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: tests-zoo:2181
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://tests-kafka:29092
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
    depends_on:
      - tests-zoo

  tests-producer:
    container_name: tests-producer
    environment:
      - KAFKA_ADDRESS=tests-kafka:9092
    image: ${PRODUCER_IMAGE}
    depends_on:
      - tests-kafka

  tests-splitter:
    container_name: tests-splitter
    environment:
      - KAFKA_ADDRESS=tests-kafka:9092
    image: ${SPLITTER_IMAGE}
    depends_on:
      - tests-kafka
